{% extends "site_base.html" %}

{% block maincontent %}
    <div>
      <h2> Käynti </h2>
      {% if visit_form.errors %}
      <div class="alert alert-warning">
          <a href="#" class="close" data-dismiss="alert">x</a>
          <strong>{{visit_form.errors}}</strong>
      </div>
      {% endif %}
      <form method="POST" form class="form-group">
      {% csrf_token %}


      <!-- <table class="table" style="table-layout:fixed">

      </table> -->
      <!-- <table class="table table-striped table-condensed "> -->
      <table class="table table-striped table-condensed" style="display:block;">
        <thead>
          <tr>
            <th class="col-md-2">Nimi</th>
            <th class="col-md-1">Määrä</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody style="display:block;height:200px;overflow-y:scroll;">
          {%for form in visit_form.visititem_forms %}
          <tr>
            <td>{{form.item_name}}</td>
            <td>{{form.count}}</td>
            <td>{{form.pk}}</td>
            <td>{{form.item_pk}}</td>
            <!-- <td>{{item.count}}</td> -->
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {{visit_form}}
      <label>{{visit_form.owner_label}}:</label> <div>{{visit_form.owner_text}}</div><br>

      <ul class="nav nav-tabs">
        {% for form in visit_form.formset %}
            <li {% if form == visit_form.formset|first %} class="active" {% endif %} ><a data-toggle="tab" href="#{{form.animal_pk}}">{{form.animal_text}}</a></li>
        {% endfor %}
      </ul>

      <div class="tab-content">
        {% for form in visit_form.formset %}
          <div id="{{form.animal_pk}}" {% if form == visit_form.formset|first %} class="tab-pane fade in active"
          {% else %} class="tab-pane fade" {% endif %}>
          {{form.anamnesis.label_tag}}
          {{form.anamnesis}}
          {{form.status.label_tag}}
          {{form.status}}
          {{form.diagnosis.label_tag}}
          {{form.diagnosis}}
          {{form.treatment.label_tag}}
          {{form.treatment}}
          <div class="form-inline">
            {{form.operations.label_tag}}
            <label for="items_search{{form.animal_pk}}">Operaatio haku: </label>
            <input class="form-control" id="items_search{{form.animal_pk}}">
            <button class="btn btn-small btn-primary ">Lisää</button>
          </div>
          <script>
            $(function() {
              $("#items_search{{form.animal_pk}}").autocomplete({source: "/api/operations/",minLength: 2,});
            });
          </script>
          {{form.operations}}
          <div class="form-inline">
            {{form.items.label_tag}}
            <label for="items_search{{form.animal_pk}}">Tuote haku: </label>
            <input class="form-control" id="items_search{{form.animal_pk}}">
            <button class="btn btn-small btn-primary ">Lisää</button>
          </div>
          <script>
            $(function() {
              $("#items_search{{form.animal_pk}}").autocomplete({source: "/api/items/",minLength: 2,});
            });
          </script>
          {{form.items}}
          </div>
        {% endfor %}
      </div>

      <!-- <div class="form-inline">
        <label for="items_search">Tuote haku: </label>
        <input class="form-control" id="items_search">
        <button class="btn btn-small btn-primary ">Lisää</button>
      </div>
      <div class="form-inline">
        <label for="operations_search">Operaatio haku: </label>
        <input class="form-control" id="operations_search">
        <button class="btn btn-small btn-primary ">Lisää</button>
      </div> -->


      <button class="btn btn-lg btn-primary " type="submit">Tallenna</button>
      </form>

      <!-- <script>
        $(function() {
          $("#items_search").autocomplete({source: "/api/items/",minLength: 2,});
        });
      </script> -->
      <!-- <script>
        $(function() {
          $("#operations_search").autocomplete({source: "/api/operations/",minLength: 2,});
        });
      </script> -->
      <script>
        console.log
        window.onload= function(){
          var ISODate = (new Date()).toISOString()
          console.log(ISODate)
          document.getElementById('id_start_time').value = ISODate;
        }
      </script>
    </div>
{% endblock %}
